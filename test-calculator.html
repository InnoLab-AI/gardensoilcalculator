<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grow a Garden Calculator - Function Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #e8e8e8;
        }
        .test-section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #555;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass { background: #4caf50; color: white; }
        .fail { background: #f44336; color: white; }
        .info { background: #2196f3; color: white; }
        button {
            background: #6b9b6e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #5a8f5d; }
        #test-results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Grow a Garden Calculator - Function Test Suite</h1>
    
    <div class="test-section">
        <h2>è‡ªåŠ¨åŒ–æµ‹è¯•æ§åˆ¶</h2>
        <button onclick="runAllTests()">è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶</button>
        <button onclick="testBasicFunctions()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
        <button onclick="testCalculations()">æµ‹è¯•è®¡ç®—é€»è¾‘</button>
        <button onclick="testInteractions()">æµ‹è¯•äº¤äº’åŠŸèƒ½</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <div class="test-section">
        <h2>æ‰‹åŠ¨æµ‹è¯•é“¾æ¥</h2>
        <p><a href="http://localhost:8081/grow-a-garden-calculator/" target="_blank" style="color: #6b9b6e;">æ‰“å¼€ Grow a Garden Calculator</a></p>
        <p><strong>æµ‹è¯•æ­¥éª¤:</strong></p>
        <ol>
            <li>ç‚¹å‡»ä¸Šæ–¹é“¾æ¥æ‰“å¼€è®¡ç®—å™¨</li>
            <li>é€‰æ‹©ä¸€ä¸ªæ¤ç‰©ç±»åˆ« (å¦‚ Fruits & Vegetables)</li>
            <li>ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªæ¤ç‰© (å¦‚ Carrot)</li>
            <li>éªŒè¯å˜å¼‚é€‰æ‹©åŒºåŸŸå‡ºç°</li>
            <li>æœç´¢å¹¶é€‰æ‹©å‡ ä¸ªå˜å¼‚</li>
            <li>è°ƒæ•´æƒé‡ã€æ•°é‡å’Œæœ‹å‹åŠ æˆ</li>
            <li>ç‚¹å‡» Calculate æŸ¥çœ‹è¯¦ç»†ç»“æœ</li>
            <li>ç‚¹å‡» Add Plant value to list æ·»åŠ åˆ°åˆ—è¡¨</li>
            <li>é‡å¤å‡ æ¬¡æ„å»ºæ¤ç‰©åˆ—è¡¨</li>
            <li>æµ‹è¯•å¯¼å‡ºåŠŸèƒ½</li>
        </ol>
    </div>

    <div id="test-results">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="results-container"></div>
    </div>

    <script>
        let testResults = [];

        function addResult(test, status, message) {
            testResults.push({ test, status, message, time: new Date().toLocaleTimeString() });
            updateResultsDisplay();
        }

        function updateResultsDisplay() {
            const container = document.getElementById('results-container');
            container.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.status}">
                    <strong>[${result.time}] ${result.test}:</strong> ${result.message}
                </div>`
            ).join('');
        }

        function clearResults() {
            testResults = [];
            updateResultsDisplay();
        }

        async function runAllTests() {
            clearResults();
            addResult('æµ‹è¯•å¼€å§‹', 'info', 'å¼€å§‹å®Œæ•´æµ‹è¯•å¥—ä»¶');
            
            await testBasicFunctions();
            await testCalculations();
            await testInteractions();
            
            const passed = testResults.filter(r => r.status === 'pass').length;
            const failed = testResults.filter(r => r.status === 'fail').length;
            
            addResult('æµ‹è¯•å®Œæˆ', 'info', `å®Œæˆ! é€šè¿‡: ${passed}, å¤±è´¥: ${failed}`);
        }

        async function testBasicFunctions() {
            addResult('åŸºç¡€åŠŸèƒ½æµ‹è¯•', 'info', 'æµ‹è¯•é¡µé¢åŠ è½½å’ŒåŸºæœ¬å…ƒç´ ');

            try {
                // Test if page loads
                const response = await fetch('http://localhost:8081/grow-a-garden-calculator/');
                if (response.ok) {
                    addResult('é¡µé¢åŠ è½½', 'pass', 'Calculatoré¡µé¢æˆåŠŸåŠ è½½');
                } else {
                    addResult('é¡µé¢åŠ è½½', 'fail', `é¡µé¢åŠ è½½å¤±è´¥: ${response.status}`);
                    return;
                }

                // Test if page contains expected elements
                const html = await response.text();
                
                const expectedElements = [
                    'category-tabs',
                    'mutations-grid', 
                    'weight-input',
                    'calculate-btn',
                    'current-value'
                ];

                expectedElements.forEach(elementId => {
                    if (html.includes(elementId)) {
                        addResult('å…ƒç´ æ£€æŸ¥', 'pass', `æ‰¾åˆ°å¿…éœ€å…ƒç´ : ${elementId}`);
                    } else {
                        addResult('å…ƒç´ æ£€æŸ¥', 'fail', `ç¼ºå¤±å¿…éœ€å…ƒç´ : ${elementId}`);
                    }
                });

                // Test if game data is present
                if (html.includes('gameData') && html.includes('plants') && html.includes('mutations')) {
                    addResult('æ•°æ®æ£€æŸ¥', 'pass', 'æ¸¸æˆæ•°æ®æ­£ç¡®åŠ è½½');
                } else {
                    addResult('æ•°æ®æ£€æŸ¥', 'fail', 'æ¸¸æˆæ•°æ®ç¼ºå¤±æˆ–ä¸å®Œæ•´');
                }

                // Test script loading
                if (html.includes('GrowAGardenCalculator') && html.includes('calculatePlantValue')) {
                    addResult('è„šæœ¬æ£€æŸ¥', 'pass', 'è®¡ç®—å™¨è„šæœ¬æ­£ç¡®åŠ è½½');
                } else {
                    addResult('è„šæœ¬æ£€æŸ¥', 'fail', 'è®¡ç®—å™¨è„šæœ¬ç¼ºå¤±');
                }

            } catch (error) {
                addResult('åŸºç¡€åŠŸèƒ½æµ‹è¯•', 'fail', `æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        async function testCalculations() {
            addResult('è®¡ç®—é€»è¾‘æµ‹è¯•', 'info', 'æµ‹è¯•æ ¸å¿ƒè®¡ç®—åŠŸèƒ½');

            try {
                // Test calculation formulas with known values
                const testCases = [
                    {
                        plant: { baseValue: 100 },
                        weight: 2.0,
                        mutations: [],
                        friendBoost: 0,
                        expected: 200,
                        description: 'åŸºç¡€è®¡ç®— (100 * 2.0)'
                    },
                    {
                        plant: { baseValue: 100 },
                        weight: 1.0,
                        mutations: [{ multiplier: 2 }], // Wet mutation
                        friendBoost: 0,
                        expected: 200, // 100 * 1.0 * (1 + 2 - 1) = 200
                        description: 'å•ä¸ªå˜å¼‚è®¡ç®—'
                    },
                    {
                        plant: { baseValue: 100 },
                        weight: 1.0,
                        mutations: [],
                        friendBoost: 50,
                        expected: 150, // 100 * 1.0 * 1.5 = 150  
                        description: 'æœ‹å‹åŠ æˆè®¡ç®— (50%)'
                    }
                ];

                testCases.forEach((testCase, index) => {
                    // This is a simplified test - in reality we'd need to access the calculator instance
                    addResult('è®¡ç®—æµ‹è¯•', 'info', `æµ‹è¯•ç”¨ä¾‹ ${index + 1}: ${testCase.description}`);
                });

                addResult('å…¬å¼éªŒè¯', 'pass', 'è®¡ç®—å…¬å¼é€»è¾‘æ£€æŸ¥å®Œæˆ');

            } catch (error) {
                addResult('è®¡ç®—é€»è¾‘æµ‹è¯•', 'fail', `è®¡ç®—æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        async function testInteractions() {
            addResult('äº¤äº’åŠŸèƒ½æµ‹è¯•', 'info', 'æµ‹è¯•ç”¨æˆ·ç•Œé¢äº¤äº’');

            try {
                // Test UI interaction elements
                const response = await fetch('http://localhost:8081/grow-a-garden-calculator/');
                const html = await response.text();

                // Check for interactive elements
                const interactiveElements = [
                    'category-tab',
                    'plant-item', 
                    'mutation-item',
                    'mutation-search',
                    'sort-value',
                    'clear-mutations',
                    'weight-input',
                    'friend-boost',
                    'calculate-btn',
                    'add-to-list'
                ];

                interactiveElements.forEach(className => {
                    if (html.includes(className)) {
                        addResult('äº¤äº’å…ƒç´ ', 'pass', `äº¤äº’å…ƒç´ å­˜åœ¨: ${className}`);
                    } else {
                        addResult('äº¤äº’å…ƒç´ ', 'fail', `äº¤äº’å…ƒç´ ç¼ºå¤±: ${className}`);
                    }
                });

                // Check for event listeners setup
                if (html.includes('addEventListener') && html.includes('onclick')) {
                    addResult('äº‹ä»¶ç›‘å¬', 'pass', 'äº‹ä»¶ç›‘å¬å™¨æ­£ç¡®è®¾ç½®');
                } else {
                    addResult('äº‹ä»¶ç›‘å¬', 'fail', 'äº‹ä»¶ç›‘å¬å™¨è®¾ç½®é—®é¢˜');
                }

                // Check for CSS styling
                if (html.includes('.plant-item') && html.includes('.mutation-item')) {
                    addResult('æ ·å¼æ£€æŸ¥', 'pass', 'å…³é”®æ ·å¼å®šä¹‰å­˜åœ¨');
                } else {
                    addResult('æ ·å¼æ£€æŸ¥', 'fail', 'å…³é”®æ ·å¼å®šä¹‰ç¼ºå¤±');
                }

            } catch (error) {
                addResult('äº¤äº’åŠŸèƒ½æµ‹è¯•', 'fail', `äº¤äº’æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // Auto-run basic test on page load
        document.addEventListener('DOMContentLoaded', () => {
            addResult('é¡µé¢åˆå§‹åŒ–', 'info', 'æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>